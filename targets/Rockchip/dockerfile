# Dockerfile for Rockchip RK3588/RK3566
# Generated by LLM Cross-Compiler Framework
# Target Architecture: aarch64

FROM debian:bookworm-slim AS builder

LABEL maintainer="Community Contributor"
LABEL description="Target for NVIDIA Jetson Orin" 
# (Hinweis: Description wird vom Generator gesetzt, hier exemplarisch f√ºr Rockchip)
LABEL target.architecture="aarch64"

# CI Args
ARG USER_ID=1000
ARG GROUP_ID=1000

ENV DEBIAN_FRONTEND=noninteractive
ENV LLAMA_CPP_PATH=/usr/src/llama.cpp
ENV BUILD_CACHE_DIR=/build-cache

# System dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
        build-essential cmake git python3-pip \
    && rm -rf /var/lib/apt/lists/*

# Copy framework modules
WORKDIR /app
COPY modules/ ./modules/
COPY scripts/ ./scripts/
RUN chmod +x modules/*.sh scripts/*.py

# Set working directory & User
WORKDIR ${BUILD_CACHE_DIR}

# Create User mapping host UID/GID
RUN groupadd -g ${GROUP_ID} llmbuilder && \
    useradd -u ${USER_ID} -g llmbuilder -d /app -s /bin/bash llmbuilder && \
    chown -R llmbuilder:llmbuilder /app

# Default entrypoint
COPY docker/entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

USER llmbuilder
ENTRYPOINT ["/entrypoint.sh"]
CMD ["interactive"]
